---
icon: meteor-icons:file-lines
date: 2025-09-23
category:
  - 統計検定1級
  - 統計数理
  - 仮説検定
tag:
  - "2013"
  - 検定
  - ウィルコクソンの符号順位検定
  - サンプルサイズ
  - 正規近似
  - 有意確率
  - 連続修正
---

# 2013年 統計数理 問4

<div style="display: flex; gap: 10px; justify-content: center;">
  <img src="/assets/images/grade1_1/2013/thumbnail.png" style="max-width: 100%; height: auto;">
</div>
<AffiliateBook id="kakomon1213"/>


:::expl
==ウィルコクソンの符号順位検定==に関する問題です.
問題文は一見難しそうですが、一つずつ整理すると簡単な確率の問題に帰着できます.

問題設定として以下の条件があります.
- 2変量連続型分布からの無作為標本 $(x_1, y_1),\dots, (x_n, y_n)$
- 差 $z_i = y_i - x_i$
- 差　$z_i$ の母集団分布 $F(z)$の中央値を $\theta$
- $H_0: \theta=0$ vs $H_1: \theta>0$
- 有意水準5%の検定
- $\theta$を中心に左右対称
- $\forall i \in \{1,\dots,n\},\; z_i \ne 0.$
- $\forall\, i\neq j\in\{1,\dots,n\},\ |z_i|\neq |z_j|$
- 棄却限界値を $c$ として $T^+ = \sum_{z_i>0}R_i > 0 \Rightarrow \text{Reject}$
:::

## [1] サンプルサイズ
:::expl
すべての $z_i$ が正でもサンプルサイズ $n$ によって検定で有意にならない.

つまり
==すべての $z_i$ が正でも $H_0$ を棄却できない.==

$H_0$を棄却できるためには $n$はいくつ以上するか, という問題です.
:::

:::ans
$H_0$ のもとでは, $z_i$が正になる確率は $\frac{1}{2}$である.
したがって有意確率 $p = 1 \times(\frac{1}{2})^n > 0.05$ のときは棄却できない.
(当たり前だが、$z_i$ がすべて正になるのは1通り)

$n$ と有意確率の値を表でまとめると,

| n | $p=(1/2)^n$ | 判定(有意水準5%) |
|---:|:-------------:|:-----------------:|
| 1 | 0.50000 | Accept |
| 2 | 0.25000 | Accept |
| 3 | 0.12500 | Accept |
| 4 | 0.06250 | Accept |
| 5 | 0.03125 | Reject |
| 6 | 0.01563 | Reject |

したがって $n$ は $5$ 以上

:::

## [2] 棄却限界値と有意確率

::: expl
おそらく[2]がこの問で一番大変だと思います.
数え上げは必ず見直しをしたいですね.

横軸を順位和, 縦軸にcountをとったときのヒストグラムと分布は以下のようになります.
<div style="display: flex; gap: 10px; justify-content: center;">
  <img src="/assets/images/grade1_1/2013/t_plus_count.png" style="max-width: 100%; height: auto;">
</div>
<div style="display: flex; gap: 10px; justify-content: center;">
  <img src="/assets/images/grade1_1/2013/t_plus_prob.png" style="max-width: 100%; height: auto;">
</div>
このとき, 右側確率が5%を超えるような順位和が棄却限界値となります.
:::

:::ans
$n=7$ のとき（差0なし・同順位なし）$T^+$ の値は $T^+\in\{0,\dots,28\}$.


| $T^+$ | 組み合わせ例 | 組み合わせ数 | 右側累積個数 | 右側確率 $p$ |
|---:|:--:|:---:|:------:|:---:|
| 28 | $\{1,2,3,4,5,6,7\}$ | 1 | 1 | $1/128=0.00781$ |
| 27 | $\{2,3,4,5,6,7\}$ | 1 | 2 | $2/128=0.0156$ |
| 26 | $\{1,3,4,5,6,7\}$ | 1 | 3 | $3/128=0.0234$ |
| 25 | $\{3,4,5,6,7\},\ \{1,2,4,5,6,7\}$ | 2 | 5 | $5/128=0.0391$ |
| 24 | $\{2,4,5,6,7\},\ \{1,2,3,5,6,7\}$ | 2 | 7 | $7/128=0.0547$ |

よって $\Pr(T^+\ge c)\le 0.05$ を満たす最小の棄却点は $c=25$.
実際の有意確率は $5/128\approx0.0391$.
:::

## [3] 期待値と分散
::: expl
同順位なし, 差0が無い場合, $I_i$ は独立に $\mathrm{Bern}(p)$ に従う確率変数 $I_i$ を用いて以下のように変形できます.  

$$ \begin{align} T^+ &= \sum_{z_i>0}R_i \\[6pt]
&= \sum_{i=1}^n R_i I_i \end{align}
$$

==ベルヌーイ分布を用いることで、全ての順位を同時に扱え、計算の見通しが良くなります.==
:::

::: ans 期待値
$$
\begin{align}
\mathbb{E}[T^+]
&=\mathbb{E}\!\left[\sum_{i=1}^{n}R_i I_i\right] \\[6pt]
&=\sum_{i=1}^{n} R_i \mathbb{E}[I_i] \\[6pt]
&=\sum_{i=1}^{n} R_i \, p \\[6pt]
&=\frac{n(n+1)}{2}\,p \\[6pt]
\end{align}
$$
$H_0$ で $p=\tfrac12$ より
$$\mathbb{E}[T^+]=\tfrac{n(n+1)}{4}$$
:::

:::ans 分散
$$
\begin{align}
\text{V}[T^+]
&=\text{V}\!\left[\sum_{i=1}^n R_i I_i\right] \\[6pt]
&=\sum_{i=1}^n R_i^2\,\text{V}[I_i] \\[6pt]
&=p(1-p)\sum_{i=1}^n R_i^2 \\[6pt]
&=p(1-p)\,\frac{n(n+1)(2n+1)}{6}\\[6pt]
\end{align}
$$

$H_0$ では,

$$\text{V}[T^+]=\dfrac{n(n+1)(2n+1)}{24}$$
:::

## [4] 正規近似　棄却域

::: expl
正規近似（連続修正無し）
$n = 7$ のとき,
$$
\begin{align}
\mu&=\frac{n(n+1)}{4} = 14, \\[6pt]
\sigma&=\sqrt{\frac{n(n+1)(2n+1)}{24}} = \sqrt{35}, \\[6pt]
T^+ &\sim \mathcal{N}(14, \sqrt{35})
\end{align}
$$
:::
::: ans

標準化すると,
$$
Z = \frac{T^+ - \mu}{\sigma} \sim \mathcal{N}(0, 1)
$$

したがって棄却域は, 
$$
\begin{align}
Z &> 1.645 \\[6pt]
\Leftrightarrow \frac{T^+ - \mu}{\sigma} &> 1.645 \\[6pt]
\Leftrightarrow \qquad T^+ &> \mu + 1.645\sigma \\[6pt]
&= 14 + 1.645\sqrt{35} \\[6pt]
&= 23.73
\end{align}
$$

$$
\begin{align}
T^+ \ge 24  \\[6pt]
\end{align}
$$
:::


::: expl
正規近似（連続修正あり）
$n = 7$ のとき,
$$
\begin{align}
T^+ &\sim \mathcal{N}(14+\tfrac{1}{2}, \sqrt{35})
\end{align}
$$
<div class="vp-card-container">
<VPCard
  title="連続修正（半整数補正）とは？"
  desc="離散型分布の正規近似"
  link="/posts/test/continuity_correction.html"
/>
</div>
:::


::: ans
標準化すると,
$$
Z = \frac{T^+ - \mu - 0.5}{\sigma} \sim \mathcal{N}(0, 1)
$$

したがって棄却域は, 
$$
\begin{align}
Z &> 1.645 \\[6pt]
\Leftrightarrow \frac{T^+ - \mu -0.5}{\sigma} &> 1.645 \\[6pt]
T^+ &\ge \mu+1.645 \sigma+0.5 \\[6pt]
&= 14 + 1.645\sqrt{35} + 0.5 \\[6pt]
&= 24.23
\end{align}
$$

$$
\begin{align}
T^+ \ge 25  \\[6pt]
\end{align}
$$
これは厳密分布の棄却域 $T^+\ge 25$ と一致する.
:::
